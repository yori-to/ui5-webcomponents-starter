function patch(oOldDom, oNewDom) {
  if (oOldDom.childElementCount != oNewDom.childElementCount || oOldDom.tagName != oNewDom.tagName) {
    oOldDom.parentNode.replaceChild(oNewDom, oOldDom);
    return false;
  }
  if (oOldDom.isEqualNode(oNewDom)) {
    return true;
  }
  var aOldAttributes = oOldDom.attributes;
  for (var i = 0, ii = aOldAttributes.length; i < ii; i++) {
    var sAttrName = aOldAttributes[i].name;
    if (oNewDom.getAttribute(sAttrName) === null) {
      oOldDom.removeAttribute(sAttrName);
      ii = ii - 1;
      i = i - 1;
    }
  }
  var aNewAttributes = oNewDom.attributes;
  for (var i = 0, ii = aNewAttributes.length; i < ii; i++) {
    var sAttrName = aNewAttributes[i].name, vOldAttrValue = oOldDom.getAttribute(sAttrName), vNewAttrValue = oNewDom.getAttribute(sAttrName);
    if (vOldAttrValue === null || vOldAttrValue !== vNewAttrValue) {
      oOldDom.setAttribute(sAttrName, vNewAttrValue);
    }
  }
  var iNewChildNodesCount = oNewDom.childNodes.length;
  if (!iNewChildNodesCount && !oOldDom.hasChildNodes()) {
    return true;
  }
  if (!oNewDom.childElementCount) {
    if (!iNewChildNodesCount) {
      oOldDom.textContent = "";
    } else if (iNewChildNodesCount == 1 && oNewDom.firstChild.nodeType == 3) {
      oOldDom.textContent = oNewDom.textContent;
    } else {
      oOldDom.innerHTML = oNewDom.innerHTML;
    }
    return true;
  }
  for (var i = 0, r = 0, ii = iNewChildNodesCount; i < ii; i++) {
    var oOldDomChildNode = oOldDom.childNodes[i], oNewDomChildNode = oNewDom.childNodes[i - r];
    if (oNewDomChildNode.nodeType == 1) {
      if (!patch(oOldDomChildNode, oNewDomChildNode)) {
        r = r + 1;
      }
    } else {
      oOldDomChildNode.nodeValue = oNewDomChildNode.nodeValue;
    }
  }
  return true;
}
export default patch;
