import MessageProcessor from './MessageProcessor.js';
import jQuery from '../../thirdparty/jquery.js';
var ControlMessageProcessor = MessageProcessor.extend('sap.ui.core.message.ControlMessageProcessor', {
    constructor: function () {
        if (!ControlMessageProcessor._instance) {
            MessageProcessor.apply(this, arguments);
            ControlMessageProcessor._instance = this;
        }
        return ControlMessageProcessor._instance;
    },
    metadata: {}
});
ControlMessageProcessor._instance = null;
ControlMessageProcessor.prototype.setMessages = function (vMessages) {
    this.mOldMessages = this.mMessages === null ? {} : this.mMessages;
    this.mMessages = vMessages || {};
    this.checkMessages();
    delete this.mOldMessages;
};
ControlMessageProcessor.prototype.checkMessages = function () {
    var aMessages, that = this, mMessages = jQuery.extend(this.mMessages, {});
    jQuery.each(this.mOldMessages, function (sTarget) {
        if (!(sTarget in mMessages)) {
            mMessages[sTarget] = [];
        }
    });
    jQuery.each(mMessages, function (sTarget) {
        var oBinding, oControl, aParts = sTarget.split('/');
        if (!aParts[0]) {
            aParts.shift();
        }
        oControl = sap.ui.getWCCore().byId(aParts[0]);
        if (!oControl) {
            return;
        }
        oBinding = oControl.getBinding(aParts[1]);
        aMessages = that.mMessages[sTarget] ? that.mMessages[sTarget] : [];
        if (oBinding) {
            var oDataState = oBinding.getDataState();
            oDataState.setControlMessages(aMessages);
            oBinding.checkDataState();
        } else {
            oControl.propagateMessages(aParts[1], aMessages);
        }
    });
};
export default ControlMessageProcessor;