import ViewRenderer from './ViewRenderer.js';
import RenderManager from '../RenderManager.js';
import jQuery from '../../thirdparty/jquery.js';
var PREFIX_DUMMY = RenderManager.RenderPrefixes.Dummy, PREFIX_INVISIBLE = RenderManager.RenderPrefixes.Invisible, PREFIX_TEMPORARY = RenderManager.RenderPrefixes.Temporary;
var XMLViewRenderer = {};
XMLViewRenderer.render = function (rm, oControl) {
    var oDomRef = oControl.getDomRef();
    if (oDomRef && !RenderManager.isPreservedContent(oDomRef)) {
        RenderManager.preserveContent(oDomRef, true);
    }
    var $oldContent = oControl._$oldContent = RenderManager.findPreservedContent(oControl.getId());
    if ($oldContent.length === 0) {
        var bSubView = oControl.isSubView();
        if (!bSubView) {
            rm.write('<div');
            rm.writeControlData(oControl);
            rm.addClass('sapUiView');
            rm.addClass('sapUiXMLView');
            ViewRenderer.addDisplayClass(rm, oControl);
            if (!oControl.oAsyncState || !oControl.oAsyncState.suppressPreserve) {
                rm.writeAttribute('data-sap-ui-preserve', oControl.getId());
            }
            if (oControl.getWidth()) {
                rm.addStyle('width', oControl.getWidth());
            }
            if (oControl.getHeight()) {
                rm.addStyle('height', oControl.getHeight());
            }
            rm.writeStyles();
            rm.writeClasses();
            rm.write('>');
        }
        if (oControl._aParsedContent) {
            for (var i = 0; i < oControl._aParsedContent.length; i++) {
                var fragment = oControl._aParsedContent[i];
                if (fragment && typeof fragment === 'string') {
                    rm.write(fragment);
                } else {
                    rm.renderControl(fragment);
                    if (!fragment.bOutput) {
                        rm.write('<div id="' + PREFIX_DUMMY + fragment.getId() + '" class="sapUiHidden"></div>');
                    }
                }
            }
        }
        if (!bSubView) {
            rm.write('</div>');
        }
    } else {
        rm.renderControl(oControl.oAfterRenderingNotifier);
        rm.write('<div id="' + PREFIX_TEMPORARY + oControl.getId() + '" class="sapUiHidden">');
        for (var i = 0; i < oControl._aParsedContent.length; i++) {
            var fragment = oControl._aParsedContent[i];
            if (typeof fragment !== 'string') {
                rm.renderControl(fragment);
                var sFragmentId = fragment.getId(), $fragment = jQuery(document.getElementById(sFragmentId));
                if ($fragment.length == 0) {
                    $fragment = jQuery(document.getElementById(PREFIX_INVISIBLE + sFragmentId));
                }
                if (!RenderManager.isPreservedContent($fragment[0])) {
                    $fragment.replaceWith('<div id="' + PREFIX_DUMMY + sFragmentId + '" class="sapUiHidden"></div>');
                }
            }
        }
        rm.write('</div>');
    }
};
export default XMLViewRenderer;